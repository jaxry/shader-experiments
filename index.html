<!DOCTYPE html>
<html class='no-js'>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
        <title>Shader Experiment</title>
        <meta name='description' content=''>
        <meta name='viewport' content='width=device-width'>

        <link rel='stylesheet' href='css/normalize.min.css'>
        <link rel='stylesheet' href='css/main.css'>

        <script src='js/vendor/stats.js'></script>

    </head>
    <body>

        <canvas id='canvas' oncontextmenu="return false;"></canvas>

        <script id='vertex-shader' type='x-shader/x-vertex'>
            attribute vec2 a_position;

            varying vec2 v_texCoord;


            void main() {
                vec2 clipSpace = a_position * 2.0 - 1.0;
               
                gl_Position = vec4(clipSpace, 0, 1);

                v_texCoord = a_position;
            }
        </script>
        
        <script id='fragment-shader' type='x-shader/x-fragment'>
            precision highp float;

            uniform vec2 u_resolution;
            uniform vec2 u_mouse;
            uniform float u_time;

            uniform vec3 u_camPos;
            uniform vec3 u_camLook;
            uniform vec3 u_camUp;
            uniform vec3 u_camRight;

            #define ITER 180
            #define MAX_DISTANCE 50.0

            float sphere(vec3 p, float s, float c) {

                p = mod(p, c) - 0.5 * c;
                return length(p) - s;
            }

            float map(vec3 p) {

                return sphere(p, 0.18 + 0.005 * sin(u_time * 5.0), 1.0);
            }

            void main() {

                vec2 uv = gl_FragCoord.xy / u_resolution - 0.5;
                uv.x *= u_resolution.x / u_resolution.y;

                vec3 ro = u_camPos;
                vec3 rd = normalize(1.0 * u_camLook + uv.x * u_camRight + uv.y * u_camUp);

                vec3 color;

                vec3 ray;
                float distance = 0.0;

                for(int i = 0; i < ITER; i++) {

                    ray = ro + distance * rd;

                    if (distance > MAX_DISTANCE) break;

                    float s = map(ray);

                    if (s <= 0.001) {

                        float ao = float(i) / float(ITER);
                        color = vec3(0.0, 0.5 - ao * 0.5, 1.0 - ao);
                        break;
                    }

                    distance += s;

                }

                color += distance / MAX_DISTANCE;

                gl_FragColor = vec4(color, 1.0);
            }
        </script>

        <script src='js/main.js'></script>
    </body>
</html>
